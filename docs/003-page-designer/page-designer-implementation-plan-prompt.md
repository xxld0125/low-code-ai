# 页面设计器技术实现规划提示词文档

**文档用途**: `/speckit.plan` 命令专用技术实现规划生成提示词
**项目名称**: FlowBase - 全栈低代码开发平台
**功能模块**: 基础页面设计器 (003-page-designer)
**创建日期**: 2025-10-27
**文档版本**: v1.0

---

## 1. 命令执行上下文

### 当前项目状态

- **技术栈**: Next.js 15 + React 19 + TypeScript + Supabase
- **认证系统**: 已完成完整的用户认证功能（注册、登录、密码重置）
- **UI框架**: shadcn/ui + Tailwind CSS
- **状态管理**: Zustand
- **数据库**: Supabase PostgreSQL + RLS权限系统
- **已完成模块**: 用户认证系统 (001-auth)

### 功能分支信息

- **分支名称**: `003-page-designer`
- **功能状态**: 需求已定义，待实现规划
- **优先级**: P1核心功能，低代码平台基础能力
- **对应规格**: [基础页面设计器规格文档](../../specs/003-page-designer/spec.md)

---

## 2. 技术实现规划模板

### 使用说明

将以下内容作为 `/speckit.plan` 命令的输入，系统将基于当前项目技术栈和需求文档生成详细的实现规划。

```
请基于以下上下文信息，为FlowBase低代码平台的基础页面设计器功能生成详细的技术实现规划：

## 项目技术背景
### 现有技术栈
- 前端：Next.js 15 + React 19 + TypeScript + Tailwind CSS + shadcn/ui
- 后端：Supabase (PostgreSQL + Auth + Storage + Edge Functions)
- 状态管理：Zustand
- 构建工具：Turbopack
- 认证：@supabase/ssr + 基于Cookie的会话管理

### 当前项目结构
```

/app/ # Next.js App Router
/auth/ # ✅ 已完成认证页面
/protected/ # ✅ 受保护的路由
/designer/ # 🚧 待开发的页面设计器
/api/ # API路由
/designer/ # 🚧 待开发的设计器API
/components/ # React组件
/designer/ # 🚧 待开发的设计器组件
/ui/ # ✅ 已有shadcn/ui组件
/lib/ # 工具库
/designer/ # 🚧 待开发的设计器核心逻辑
/supabase/ # ✅ 已有Supabase配置
/stores/ # Zustand状态管理
/types/ # TypeScript类型定义

```

## 功能需求概述
### 核心功能 (来自规格文档)
1. **组件拖拽系统**: 从组件面板拖拽组件到画布
2. **基础布局系统**: Container容器、Row行布局、Col列布局
3. **组件操作**: 选择、移动、删除画布上的组件
4. **画布功能**: 缩放、对齐辅助线、重置视图
5. **实时保存**: 自动保存用户的页面设计内容

### 用户故事要点
- 用户30秒内完成从组件面板拖拽组件到画布
- 用户2分钟内创建包含标题、按钮和输入框的简单表单页面
- 95%的拖拽操作在100ms内提供视觉反馈
- 对齐辅助线帮助用户5秒内完成组件精确对齐

### 关键实体识别
- **页面设计**: 包含组件树结构和样式配置
- **组件实例**: 类型、属性、位置、层级关系
- **布局容器**: Container、Row、Col等布局组件
- **设计历史**: 操作历史、撤销重做功能

## 技术约束要求
### 性能要求
- 确保拖拽操作流畅，页面加载合理，组件渲染无卡顿

### 安全要求
- 基于Supabase RLS的权限控制
- 用户设计数据隔离
- 防止XSS和恶意代码注入
- 安全的组件属性存储

### 兼容性要求
- 符合WCAG 2.1 AA无障碍标准
- 支持现代浏览器（Chrome 88+, Firefox 85+, Safari 14+）
- 响应式设计，适配桌面端
- 数据自动保存，防止工作丢失

## 集成要求
### 与现有系统集成
- 无缝集成现有用户认证系统
- 利用现有shadcn/ui组件库
- 遵循现有项目架构和代码规范
- 为后续数据模型设计器预留接口

### 技术架构要求
- 基于React 19的现代化组件架构
- 使用Zustand进行状态管理
- 基于Supabase的数据持久化
- 模块化的设计器核心逻辑

### 设计器核心要求
- 三栏布局：组件面板、画布、属性面板
- 支持组件拖拽和实时预览
- 灵活的布局系统(Container/Row/Col)
- 可扩展的组件架构

请生成包含以下内容的详细技术实现规划：
1. 整体架构设计方案
2. 数据模型设计
3. 前端组件架构设计
4. 拖拽系统设计
5. 布局引擎设计
6. API接口设计
7. 关键技术实现细节
8. 开发步骤和里程碑
9. 测试策略
10. 风险识别和应对方案
```

---

## 3. 预期输出内容

### 架构设计部分应包含

- 页面设计器的整体架构图
- 三栏布局组件层次结构
- 拖拽系统的技术架构
- 状态管理方案(Zustand)
- 组件注册和渲染机制

### 数据模型设计部分应包含

- 页面设计数据表结构
- 组件实例数据模型
- 布局容器数据结构
- 设计历史记录模型
- RLS权限策略设计

### 前端组件架构部分应包含

- DesignerLayout三栏布局组件
- ComponentPanel组件面板
- Canvas画布组件
- PropertiesPanel属性面板
- 可扩展的组件库系统

### 拖拽系统设计部分应包含

- HTML5 Drag and Drop API集成
- 拖拽状态管理
- 组件放置逻辑
- 视觉反馈系统
- 拖拽性能优化

### 布局引擎设计部分应包含

- Container/Row/Col布局组件
- 响应式布局算法
- 组件嵌套规则
- 对齐辅助线系统
- 布局约束验证

### API接口设计部分应包含

- 页面设计CRUD操作
- 组件管理API
- 实时保存API
- 设计历史API
- 权限验证中间件

### 技术实现部分应包含

- 组件渲染引擎
- 属性配置系统
- 撤销重做机制
- 自动保存逻辑
- 错误处理和恢复

### 开发计划部分应包含

- 详细的开发步骤
- 关键里程碑
- 依赖关系识别
- 时间估算
- 验收标准定义

### 测试策略部分应包含

- 拖拽交互测试
- 布局功能测试
- 性能基准测试
- 用户验收测试用例
- 可访问性测试

### 风险管理部分应包含

- 拖拽性能风险识别
- 复杂布局处理难点
- 状态同步复杂度
- 浏览器兼容性问题
- 应对解决方案

---

## 4. 技术实现重点提示

### 4.1 拖拽系统要点

- 使用React DnD或原生HTML5 Drag API
- 实现高性能的拖拽渲染
- 处理复杂的拖拽状态
- 优化拖拽视觉反馈
- 支持触摸设备拖拽

### 4.2 布局引擎要点

- 实现Flexbox布局算法
- 支持响应式断点
- 处理组件嵌套约束
- 实现智能对齐辅助
- 布局冲突检测和解决

### 4.3 状态管理要点

- 使用Zustand管理设计器状态
- 实现高效的状态更新机制
- 处理复杂的组件树结构
- 支持撤销重做操作
- 状态持久化和恢复

### 4.4 性能优化要点

- 虚拟化长列表组件
- 实现组件懒加载
- 优化重渲染性能
- 实现增量保存
- 内存泄漏防护

### 4.5 用户体验要点

- 流畅的拖拽交互
- 直观的视觉反馈
- 实时保存提示
- 键盘快捷键支持
- 无障碍访问支持

---

## 5. 输出格式要求

### 文档结构

1. **执行摘要** - 技术方案概述
2. **架构设计** - 系统架构和核心组件
3. **详细实现** - 各模块具体实现方案
4. **开发计划** - 分阶段实施计划
5. **质量保证** - 测试和验证策略
6. **风险管理** - 风险识别和应对措施

### 代码示例要求

- 提供关键功能的TypeScript代码片段
- 包含完整的类型定义
- 遵循项目现有代码规范
- 注释清晰，便于理解

### 图表要求

- 使用Mermaid语法绘制架构图
- 提供清晰的组件关系图
- 包含数据流程图
- 标注关键技术决策点

---

## 6. 使用指南

### 执行命令

```bash
/speckit.plan [将上述模板内容粘贴为输入]
```

### 预期结果

执行后将生成一个名为 `plan.md` 的文档，包含：

- 详细的技术架构设计
- 完整的实现步骤规划
- 具体的代码示例和配置
- 明确的里程碑和验收标准
- 全面的风险识别和应对方案

### 后续使用

生成的规划文档将作为：

- 开发团队的技术指导文档
- 项目进度跟踪的基准
- 代码审查的参考标准
- 测试策略制定的依据

---

## 7. 相关文档

- [基础页面设计器功能规格](../../specs/003-page-designer/spec.md)
- [项目管理功能实现规划](../001-project-management/speckit-plan-prompt.md)
- [数据模型设计器实现规划](../002-data-model-designer/data-model-designer-implementation-plan-prompt.md)

---

**文档结束**

_注：本提示词文档专为FlowBase项目的基础页面设计器功能定制，确保生成的技术规划与项目现有技术栈和架构完美契合，同时为后续的数据模型设计器和其他低代码功能奠定坚实基础。_
